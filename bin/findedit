#!/bin/bash

OPTIND=1

while getopts "le:" opt; do
    case $opt in
        l)
            lineopt="-n"
            ;;
        e)
            editor=$OPTARG
            ;;
        \?)
            echo "Invalid argument -$OPTARG"
            exit 1
            ;;
    esac
done

line=$(rg . $lineopt | fzf +m --height 100 -e)
if [ "$line" == "" ]; then
    exit 0
fi

file=$(echo "$line" | awk -F"[:]" '{print $1}')

if [ -n "$lineopt" ]; then
    lineno=$(echo "$line" | awk -F"[:]" '{print $2}')
fi

editor=$(echo "$editor" | sed -r "s|\{f\}|$file|g")
editor=$(echo "$editor" | sed -r "s/\{l\}/$lineno/g")

$editor
